var Windy=function(t){var n=1/7e4,r=10,e=40,a=100,o=.8,i=8,u=.75,f=20,h=[0/0,0/0,null],c=(2*Math.PI,Math.pow(10,-5.2),function(t,n,r,e,a,o){var i=1-t,u=1-n,f=i*u,h=t*u,c=i*n,l=t*n,s=r[0]*f+e[0]*h+a[0]*c+o[0]*l,d=r[1]*f+e[1]*h+a[1]*c+o[1]*l;return[s,d,Math.sqrt(s*s+d*d)]}),l=function(t,n){var r=t.data,e=n.data;return{header:t.header,data:function(t){return[r[t],e[t]]},interpolate:c}},s=function(t){var n=null,r=null,e=null;return t.forEach(function(t){switch(t.header.parameterCategory+","+t.header.parameterNumber){case"2,2":n=t;break;case"2,3":r=t;break;default:e=t}}),l(n,r)},d=function(t,n){function r(t,n){var r,a=M(t-o,360)/u,h=(i-n)/f,c=Math.floor(a),l=c+1,s=Math.floor(h),b=s+1;if(r=d[s]){var g=r[c],w=r[l];if(m(g)&&m(w)&&(r=d[b])){var v=r[c],p=r[l];if(m(v)&&m(p))return e.interpolate(a-c,h-s,g,w,v,p)}}return null}var e=s(t),a=e.header,o=a.lo1,i=a.la1,u=a.dx,f=a.dy,h=a.nx,c=a.ny,l=new Date(a.refTime);l.setHours(l.getHours()+a.forecastTime);for(var d=[],b=0,g=Math.floor(h*u)>=360,w=0;c>w;w++){for(var v=[],p=0;h>p;p++,b++)v[p]=e.data(b);g&&v.push(v[0]),d[w]=v}n({date:l,interpolate:r})},m=function(t){return null!==t&&void 0!==t},M=function(t,n){return t-n*Math.floor(t/n)},b=function(){return/android|blackberry|iemobile|ipad|iphone|ipod|opera mini|webos/i.test(navigator.userAgent)},g=function(t,n,r,e,a,o,i,u){var f=i[0]*o,h=i[1]*o,c=w(t,n,r,e,a,u);return i[0]=c[0]*f+c[2]*h,i[1]=c[1]*f+c[3]*h,i},w=function(t,n,r,e,a,o){var i=2*Math.PI,u=Math.pow(10,-5.2),f=0>n?u:-u,h=0>r?u:-u,c=A(r,n+f,o),l=A(r+h,n,o),s=Math.cos(r/360*i);return[(c[0]-e)/f/s,(c[1]-a)/f/s,(l[0]-e)/h,(l[1]-a)/h]},v=function(t,n,r){function e(n,r){var e=t[Math.round(n)];return e&&e[Math.round(r)]||h}e.release=function(){t=[]},e.randomize=function(t){var r,a,o=0;do r=Math.round(Math.floor(Math.random()*n.width)+n.x),a=Math.round(Math.floor(Math.random()*n.height)+n.y);while(null===e(r,a)[2]&&o++<30);return t.x=r,t.y=a,t},r(n,e)},p=function(t,n,r){var e=t[0],a=t[1],o=Math.round(e[0]),i=Math.max(Math.floor(e[1],0),0),u=(Math.min(Math.ceil(a[0],n),n-1),Math.min(Math.ceil(a[1],r),r-1));return{x:o,y:i,xMax:n,yMax:u,width:n,height:r}},x=function(t){return t/180*Math.PI},y=function(t){return t/(Math.PI/180)},I=function(t,n,r){var e=r.east-r.west,a=r.width/y(e)*360/(2*Math.PI),o=a/2*Math.log((1+Math.sin(r.south))/(1-Math.sin(r.south))),i=r.height+o,u=(i-n)/a,f=180/Math.PI*(2*Math.atan(Math.exp(u))-Math.PI/2),h=y(r.west)+t/r.width*y(e);return[h,f]},F=function(t){return Math.log(Math.tan(t/2+Math.PI/4))},A=function(t,n,r){var e=F(r.south),a=F(r.north),o=r.width/(r.east-r.west),i=r.height/(a-e),u=F(x(t)),f=(x(n)-r.west)*o,u=(a-u)*i;return[f,u]},P=function(t,r,e,a){function o(n){for(var a=[],o=r.y;o<=r.yMax;o+=2){var h=I(n,o,e);if(h){var c=h[0],l=h[1];if(isFinite(c)){var s=t.interpolate(c,l);s&&(s=g(i,c,l,n,o,u,s,e),a[o+1]=a[o]=s)}}}f[n+1]=f[n]=a}var i={},u=r.height*n,f=[],h=r.x;!function c(){for(var t=Date.now();h<r.width;)if(o(h),h+=2,Date.now()-t>1e3)return void setTimeout(c,25);v(f,r,a)}()},q=function(n,h){function c(t){return parseInt(d(t).substring(0,2),16)}function l(t){return parseInt(d(t).substring(2,4),16)}function s(t){return parseInt(d(t).substring(4,6),16)}function d(t){return"#"==t.charAt(0)?t.substring(1,7):t}function m(t,n){return result=["rgba("+c("#178be7")+", "+l("#178be7")+", "+s("#178be7")+", 1.5)","rgba("+c("#8888bd")+", "+l("#8888bd")+", "+s("#8888bd")+", 1.5)","rgba("+c("#b28499")+", "+l("#b28499")+", "+s("#b28499")+", 1.5)","rgba("+c("#cc7e78")+", "+l("#cc7e78")+", "+s("#cc7e78")+", 1.5)","rgba("+c("#de765b")+", "+l("#de765b")+", "+s("#de765b")+", 1.5)","rgba("+c("#ec6c42")+", "+l("#ec6c42")+", "+s("#ec6c42")+", 1.5)","rgba("+c("#f55f2c")+", "+l("#f55f2c")+", "+s("#f55f2c")+", 1.5)","rgba("+c("#fb4f17")+", "+l("#fb4f17")+", "+s("#fb4f17")+", 1.5)","rgba("+c("#fe3705")+", "+l("#fe3705")+", "+s("#fe3705")+", 1.5)","rgba("+c("#ff0000")+", "+l("#ff0000")+", "+s("#ff0000")+", 1.5)"],result.indexFor=function(t){return Math.floor(Math.min(t,n)/n*(result.length-1))},result}function M(){v.forEach(function(t){t.length=0}),y.forEach(function(t){t.age>a&&(h.randomize(t).age=0);var n=t.x,r=t.y,e=h(n,r),o=e[2];if(null===o)t.age=a;else{var i=n+e[0],u=r+e[1];null!==h(i,u)[2]?(t.xt=i,t.yt=u,v[w.indexFor(o)].push(t)):(t.x=i,t.y=u)}t.age+=1})}function g(){var t=F.globalCompositeOperation;F.globalCompositeOperation="destination-in",F.fillRect(n.x,n.y,n.width,n.height),F.globalCompositeOperation=t,v.forEach(function(t,n){t.length>0&&(F.beginPath(),F.strokeStyle=w[n],t.forEach(function(t){F.moveTo(t.x,t.y),F.lineTo(t.xt,t.yt),t.x=t.xt,t.y=t.yt}),F.stroke())})}var w=m(r,e),v=w.map(function(){return[]}),p=Math.round(n.width*i);b()&&(p*=u);for(var x="rgba(0, 0, 0, 0.97)",y=[],I=0;p>I;I++)y.push(h.randomize({age:Math.floor(Math.random()*a)+0}));var F=t.canvas.getContext("2d");F.lineWidth=o,F.fillStyle=x,function A(){try{C.timer=setTimeout(function(){requestAnimationFrame(A),M(),g()},1e3/f)}catch(t){console.error(t)}}()},T=function(n,r,e,a){var o={south:x(a[0][1]),north:x(a[1][1]),east:x(a[1][0]),west:x(a[0][0]),width:r,height:e};k(),d(t.data,function(t){P(t,p(n,r,e),o,function(t,n){C.field=n,q(t,n)})})},k=function(){C.field&&C.field.release(),C.timer&&clearTimeout(C.timer)},C={params:t,start:T,stop:k};return C};window.requestAnimationFrame=function(){return window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(t){window.setTimeout(t,50)}}();