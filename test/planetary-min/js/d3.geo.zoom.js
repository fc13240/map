!function(){function t(t,n,a){var r=t.translate(),o=Math.atan2(n[1]-r[1],n[0]-r[0])-Math.atan2(a[1]-r[1],a[0]-r[0]);return[Math.cos(o/2),0,0,Math.sin(o/2)]}function n(t,n){var a=t.invert(n);return a&&isFinite(a[0])&&isFinite(a[1])&&u(a)}function a(t){var n=.5*t[0]*f,a=.5*t[1]*f,r=.5*t[2]*f,o=Math.sin(n),e=Math.cos(n),i=Math.sin(a),u=Math.cos(a),c=Math.sin(r),s=Math.cos(r);return[e*u*s+o*i*c,o*u*s-e*i*c,e*i*s+o*u*c,e*u*c-o*i*s]}function r(t,n){var a=t[0],r=t[1],o=t[2],e=t[3],i=n[0],u=n[1],c=n[2],s=n[3];return[a*i-r*u-o*c-e*s,a*u+r*i+o*s-e*c,a*c-r*s+o*i+e*u,a*s+r*c-o*u+e*i]}function o(t,n){if(t&&n){var a=s(t,n),r=Math.sqrt(c(a,a)),o=.5*Math.acos(Math.max(-1,Math.min(1,c(t,n)))),e=Math.sin(o)/r;return r&&[Math.cos(o),a[2]*e,-a[1]*e,a[0]*e]}}function e(t,n){var a=Math.max(-1,Math.min(1,c(t,n))),r=0>a?-1:1,o=Math.acos(r*a),e=Math.sin(o);return e?function(a){var i=r*Math.sin((1-a)*o)/e,u=Math.sin(a*o)/e;return[t[0]*i+n[0]*u,t[1]*i+n[1]*u,t[2]*i+n[2]*u,t[3]*i+n[3]*u]}:function(){return t}}function i(t){return[Math.atan2(2*(t[0]*t[1]+t[2]*t[3]),1-2*(t[1]*t[1]+t[2]*t[2]))*m,Math.asin(Math.max(-1,Math.min(1,2*(t[0]*t[2]-t[3]*t[1]))))*m,Math.atan2(2*(t[0]*t[3]+t[1]*t[2]),1-2*(t[2]*t[2]+t[3]*t[3]))*m]}function u(t){var n=t[0]*f,a=t[1]*f,r=Math.cos(a);return[r*Math.cos(n),r*Math.sin(n),Math.sin(a)]}function c(t,n){for(var a=0,r=t.length,o=0;r>a;++a)o+=t[a]*n[a];return o}function s(t,n){return[t[1]*n[2]-t[2]*n[1],t[2]*n[0]-t[0]*n[2],t[0]*n[1]-t[1]*n[0]]}function h(t){for(var n=0,a=arguments.length,r=[];++n<a;)r.push(arguments[n]);var o=d3.dispatch.apply(null,r);return o.of=function(n,a){return function(r){try{var e=r.sourceEvent=d3.event;r.target=t,d3.event=r,o[r.type].apply(n,a)}finally{d3.event=e}}},o}var f=Math.PI/180,m=180/Math.PI;d3.geo.zoom=function(){function c(t){l++||t({type:"zoomstart"})}function s(t){t({type:"zoom"})}function f(t){--l||t({type:"zoomend"})}var m,M,v,l=0,d=h(z,"zoomstart","zoom","zoomend"),z=d3.behavior.zoom().on("zoomstart",function(){var e=d3.mouse(this),u=a(m.rotate()),h=n(m,e);h&&(v=h),_.call(z,"zoom",function(){m.scale(g.k=d3.event.scale);var a=d3.mouse(this),c=o(v,n(m,a));m.rotate(g.r=i(u=c?r(u,c):r(t(m,e,a),u))),e=a,s(d.of(this,arguments))}),c(d.of(this,arguments))}).on("zoomend",function(){_.call(z,"zoom",null),f(d.of(this,arguments))}),_=z.on,g={r:[0,0,0],k:1};return z.rotateTo=function(t){var n=o(u(t),u([-g.r[0],-g.r[1]]));return i(r(a(g.r),n))},z.projection=function(t){return arguments.length?(m=t,g={r:m.rotate(),k:m.scale()},z.scale(g.k)):m},z.duration=function(t){return arguments.length?(M=t,z):M},z.event=function(t){t.each(function(){var t=d3.select(this),n=d.of(this,arguments),r=g,o=d3.transition(t);if(o!==t){o.each("start.zoom",function(){this.__chart__&&(g=this.__chart__),m.rotate(g.r).scale(g.k),c(n)}).tween("zoom:zoom",function(){var t=z.size()[0],u=e(a(g.r),a(r.r)),c=d3.geo.distance(g.r,r.r),h=d3.interpolateZoom([0,0,t/g.k],[c,0,t/r.k]);return M&&o.duration(M(.001*h.duration)),function(a){var r=h(a);this.__chart__=g={r:i(u(r[0]/c)),k:t/r[2]},m.rotate(g.r).scale(g.k),z.scale(g.k),s(n)}}).each("end.zoom",function(){f(n)});try{o.each("interrupt.zoom",function(){f(n)})}catch(u){}}else this.__chart__=g,c(n),s(n),f(n)})},d3.rebind(z,d,"on")}}();